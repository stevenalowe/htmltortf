var cloudconvert = require('../');
var fs = require('fs'), stream = require('stream');

if (!process.env.API_KEY) {
    console.warn('The tests requires the API_KEY environment variable.');
}

module.exports = {

/*

    'test if process upload method works': function (test) {
        "use strict";


        var api = new cloudconvert(process.env.API_KEY);

        api.createProcess({inputformat: 'png', outputformat: 'jpg'}, function(err, process) {

            //process.refresh(null, function(err, process)
            //{

                process.on('progress', function (data) {
                   console.log(data.percent);
                });

                process.upload("input.png", fs.createReadStream(__dirname + '/input.png'), function (err, process) {
                    test.ok(!err);
                    process.start({
                        outputformat: 'jpg',
                        input: 'upload',
                    }, function (err, process) {
                        process.wait();
                        process.on('finished', function(data) {
                            test.done();

                            // cleanup
                            process.delete();
                        });


                    });
                });
            //});
        });


    },

*/

    'test if piping a non file stream works': function (test) {
        "use strict";

        var api = new cloudconvert(process.env.API_KEY);




        fs.createReadStream(__dirname  + '/UNTERIRDISCHE HYDROKULTUR ★ Minecraft FALLOUT #11 ★ LPmitKev | Minecraft Revolution Modpack.png').pipe(api.convert({
            inputformat: 'png',
            outputformat: 'jpg',
        }).on('downloaded', function(destination) {
            test.ok(fs.statSync(destination.path).size > 0);
            test.done();

            // cleanup
            //this.delete();
            fs.unlinkSync(destination.path);
        }).on('progress', function(data) {
            console.log(data.percent + data.message);
        }).on('finished', function(err) {
            console.log(err.toString());
            this.download(fs.createWriteStream(__dirname  + '/out.jpg'), "UNTERIRDISCHE HYDROKULTUR ★ Minecraft FALLOUT #11 ★ LPmitKev | Minecraft Revolution Modpack.jpg");
        }));//.pipe(fs.createWriteStream(__dirname  + '/out.pdf'));


    },


/*
    'test if piping a non file stream works': function (test) {
        "use strict";

        var api = new cloudconvert(process.env.API_KEY);

        // create the process. see https://cloudconvert.com/apidoc#create
        api.createProcess({inputformat: 'png', outputformat: 'pdf'}, function(err, process) {

            if(err) {
                console.error('CloudConvert Process creation failed: ' + err);
            } else {

                // start the process. see https://cloudconvert.com/apidoc#create
                process.start({
                    outputformat: 'jpg',
                    converteroptions: {
                        quality : 75,
                    },
                    input: 'upload'
                }, function (err, process) {

                    if (err) {
                        console.error('CloudConvert Process start failed: ' + err);
                    } else {

                        // upload the input file. see https://cloudconvert.com/apidoc#upload
                        process.upload(fs.createReadStream('tests/input.png'), null, function (err, process) {

                            if (err) {
                                console.error('CloudConvert Process upload failed: ' + err);
                            } else {
                                // wait until the process is finished (or completed with an error)
                                process.wait(function (err, process) {
                                    if (err) {
                                        console.error('CloudConvert Process failed: ' + err);
                                    } else {
                                        console.log('Done: ' + process.data.message);

                                        // download it
                                        process.download(fs.createWriteStream("out.jpg"), null, function (err, process) {
                                            if (err) {
                                                console.error('CloudConvert Process download failed: ' + err);
                                            } else {
                                                console.log('Downloaded to out.jpg');
                                            }
                                        });
                                    }

                                });
                            }
                        });


                    }
                });
            }

        });


    },

*/



};